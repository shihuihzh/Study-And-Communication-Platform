(function(){$.Jcrop=function(c,C){var K=$.extend({},$.Jcrop.defaults),ah,at,aj=false;function l(au){return parseInt(au,10)+"px"}function N(au){return parseInt(au,10)+"%"}function E(au){return K.baseClass+"-"+au}function F(){return $.fx.step.hasOwnProperty("backgroundColor")}function G(au){var av=$(au).offset();return[av.left,av.top]}function I(au){return[(au.pageX-ah[0]),(au.pageY-ah[1])]}function B(au){if(typeof(au)!=="object"){au={}}K=$.extend(K,au);if(typeof(K.onChange)!=="function"){K.onChange=function(){}}if(typeof(K.onSelect)!=="function"){K.onSelect=function(){}}if(typeof(K.onRelease)!=="function"){K.onRelease=function(){}}}function H(au){if(au!==at){S.setCursor(au);at=au}}function e(aw,ay){ah=G(aq);S.setCursor(aw==="move"?aw:aw+"-resize");if(aw==="move"){return S.activateHandlers(U(ay),p)}var au=ad.getFixed();var av=r(aw);var ax=ad.getCorner(r(av));ad.setPressed(ad.getCorner(av));ad.setCurrent(ax);S.activateHandlers(J(aw,au),p)}function J(av,au){return function(aw){if(!K.aspectRatio){switch(av){case"e":aw[1]=au.y2;break;case"w":aw[1]=au.y2;break;case"n":aw[0]=au.x2;break;case"s":aw[0]=au.x2;break}}else{switch(av){case"e":aw[1]=au.y+1;break;case"w":aw[1]=au.y+1;break;case"n":aw[0]=au.x+1;break;case"s":aw[0]=au.x+1;break}}ad.setCurrent(aw);Z.update()}}function U(av){var au=av;ap.watchKeys();return function(aw){ad.moveOffset([aw[0]-au[0],aw[1]-au[1]]);au=aw;Z.update()}}function r(au){switch(au){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function b(au){return function(av){if(K.disabled){return false}if((au==="move")&&!K.allowMove){return false}q=true;e(au,I(av));av.stopPropagation();av.preventDefault();return false}}function X(ay,av,ax){var au=ay.width(),aw=ay.height();if((au>av)&&av>0){au=av;aw=(av/ay.width())*ay.height()}if((aw>ax)&&ax>0){aw=ax;au=(ax/ay.height())*ay.width()}P=ay.width()/au;d=ay.height()/aw;ay.width(au).height(aw)}function ab(au){return{x:parseInt(au.x*P,10),y:parseInt(au.y*d,10),x2:parseInt(au.x2*P,10),y2:parseInt(au.y2*d,10),w:parseInt(au.w*P,10),h:parseInt(au.h*d,10)}}function p(av){var au=ad.getFixed();if((au.w>K.minSelect[0])&&(au.h>K.minSelect[1])){Z.enableHandles();Z.done()}else{Z.release()}S.setCursor(K.allowSelect?"crosshair":"default")}function ag(au){if(K.disabled){return false}if(!K.allowSelect){return false}q=true;ah=G(aq);Z.disableHandles();H("crosshair");var av=I(au);ad.setPressed(av);Z.update();S.activateHandlers(ao,p);ap.watchKeys();au.stopPropagation();au.preventDefault();return false}function ao(au){ad.setCurrent(au);Z.update()}function ai(){var au=$("<div></div>").addClass(E("tracker"));if($.browser.msie){au.css({opacity:0,backgroundColor:"white"})}return au}if($.browser.msie&&($.browser.version.split(".")[0]==="6")){aj=true}if(typeof(c)!=="object"){c=$(c)[0]}if(typeof(C)!=="object"){C={}}B(C);var g={border:"none",margin:0,padding:0,position:"absolute"};var aa=$(c);var aq=aa.clone().removeAttr("id").css(g);aq.width(aa.width());aq.height(aa.height());aa.after(aq).hide();X(aq,K.boxWidth,K.boxHeight);var T=aq.width(),R=aq.height(),ac=$("<div />").width(T).height(R).addClass(E("holder")).css({position:"relative",backgroundColor:K.bgColor}).insertAfter(aa).append(aq);delete (K.bgColor);if(K.addClass){ac.addClass(K.addClass)}var L=$("<img />").attr("src",aq.attr("src")).css(g).width(T).height(R),k=$("<div />").width(N(100)).height(N(100)).css({zIndex:310,position:"absolute",overflow:"hidden"}).append(L),O=$("<div />").width(N(100)).height(N(100)).css("zIndex",320),A=$("<div />").css({position:"absolute",zIndex:300}).insertBefore(aq).append(k,O);if(aj){A.css({overflowY:"hidden"})}var t=K.boundary;var a=ai().width(T+(t*2)).height(R+(t*2)).css({position:"absolute",top:l(-t),left:l(-t),zIndex:290}).mousedown(ag);var ae=K.bgOpacity,z,am,o,W,P,d,n=true,q,D,af;ah=G(aq);var V=(function(){function au(){var aB={},az=["touchstart","touchmove","touchend"],aA=document.createElement("div"),ay;try{for(ay=0;ay<az.length;ay++){var aw=az[ay];aw="on"+aw;var ax=(aw in aA);if(!ax){aA.setAttribute(aw,"return;");ax=typeof aA[aw]=="function"}aB[az[ay]]=ax}return aB.touchstart&&aB.touchend&&aB.touchmove}catch(aC){return false}}function av(){if((K.touchSupport===true)||(K.touchSupport===false)){return K.touchSupport}else{return au()}}return{createDragger:function(aw){return function(ax){ax.pageX=ax.originalEvent.changedTouches[0].pageX;ax.pageY=ax.originalEvent.changedTouches[0].pageY;if(K.disabled){return false}if((aw==="move")&&!K.allowMove){return false}q=true;e(aw,I(ax));ax.stopPropagation();ax.preventDefault();return false}},newSelection:function(aw){aw.pageX=aw.originalEvent.changedTouches[0].pageX;aw.pageY=aw.originalEvent.changedTouches[0].pageY;return ag(aw)},isSupported:au,support:av()}}());var ad=(function(){var aw=0,aH=0,av=0,aG=0,az,ax;function aB(aK){aK=ay(aK);av=aw=aK[0];aG=aH=aK[1]}function aA(aK){aK=ay(aK);az=aK[0]-av;ax=aK[1]-aG;av=aK[0];aG=aK[1]}function aJ(){return[az,ax]}function au(aM){var aL=aM[0],aK=aM[1];if(0>aw+aL){aL-=aL+aw}if(0>aH+aK){aK-=aK+aH}if(R<aG+aK){aK+=R-(aG+aK)}if(T<av+aL){aL+=T-(av+aL)}aw+=aL;av+=aL;aH+=aK;aG+=aK}function aC(aK){var aL=aI();switch(aK){case"ne":return[aL.x2,aL.y];case"nw":return[aL.x,aL.y];case"se":return[aL.x2,aL.y2];case"sw":return[aL.x,aL.y2]}}function aI(){if(!K.aspectRatio){return aF()}var aM=K.aspectRatio,aS=K.minSize[0]/P,aL=K.maxSize[0]/P,aU=K.maxSize[1]/d,aN=av-aw,aT=aG-aH,aO=Math.abs(aN),aP=Math.abs(aT),aQ=aO/aP,aK,aR;if(aL===0){aL=T*10}if(aU===0){aU=R*10}if(aQ<aM){aR=aG;w=aP*aM;aK=aN<0?aw-w:w+aw;if(aK<0){aK=0;h=Math.abs((aK-aw)/aM);aR=aT<0?aH-h:h+aH}else{if(aK>T){aK=T;h=Math.abs((aK-aw)/aM);aR=aT<0?aH-h:h+aH}}}else{aK=av;h=aO/aM;aR=aT<0?aH-h:aH+h;if(aR<0){aR=0;w=Math.abs((aR-aH)*aM);aK=aN<0?aw-w:w+aw}else{if(aR>R){aR=R;w=Math.abs(aR-aH)*aM;aK=aN<0?aw-w:w+aw}}}if(aK>aw){if(aK-aw<aS){aK=aw+aS}else{if(aK-aw>aL){aK=aw+aL}}if(aR>aH){aR=aH+(aK-aw)/aM}else{aR=aH-(aK-aw)/aM}}else{if(aK<aw){if(aw-aK<aS){aK=aw-aS}else{if(aw-aK>aL){aK=aw-aL}}if(aR>aH){aR=aH+(aw-aK)/aM}else{aR=aH-(aw-aK)/aM}}}if(aK<0){aw-=aK;aK=0}else{if(aK>T){aw-=aK-T;aK=T}}if(aR<0){aH-=aR;aR=0}else{if(aR>R){aH-=aR-R;aR=R}}return aE(aD(aw,aH,aK,aR))}function ay(aK){if(aK[0]<0){aK[0]=0}if(aK[1]<0){aK[1]=0}if(aK[0]>T){aK[0]=T}if(aK[1]>R){aK[1]=R}return[aK[0],aK[1]]}function aD(aN,aP,aM,aO){var aR=aN,aQ=aM,aL=aP,aK=aO;if(aM<aN){aR=aM;aQ=aN}if(aO<aP){aL=aO;aK=aP}return[Math.round(aR),Math.round(aL),Math.round(aQ),Math.round(aK)]}function aF(){var aL=av-aw,aK=aG-aH,aM;if(z&&(Math.abs(aL)>z)){av=(aL>0)?(aw+z):(aw-z)}if(am&&(Math.abs(aK)>am)){aG=(aK>0)?(aH+am):(aH-am)}if(W/d&&(Math.abs(aK)<W/d)){aG=(aK>0)?(aH+W/d):(aH-W/d)}if(o/P&&(Math.abs(aL)<o/P)){av=(aL>0)?(aw+o/P):(aw-o/P)}if(aw<0){av-=aw;aw-=aw}if(aH<0){aG-=aH;aH-=aH}if(av<0){aw-=av;av-=av}if(aG<0){aH-=aG;aG-=aG}if(av>T){aM=av-T;aw-=aM;av-=aM}if(aG>R){aM=aG-R;aH-=aM;aG-=aM}if(aw>T){aM=aw-R;aG-=aM;aH-=aM}if(aH>R){aM=aH-R;aG-=aM;aH-=aM}return aE(aD(aw,aH,av,aG))}function aE(aK){return{x:aK[0],y:aK[1],x2:aK[2],y2:aK[3],w:aK[2]-aK[0],h:aK[3]-aK[1]}}return{flipCoords:aD,setPressed:aB,setCurrent:aA,getOffset:aJ,moveOffset:au,getCorner:aC,getFixed:aI}}());var Z=(function(){var aE,aM=370;var az={};var aP={};var aw=false;var aD=K.handleOffset;function aA(aT){var aU=$("<div />").css({position:"absolute",opacity:K.borderOpacity}).addClass(E(aT));k.append(aU);return aU}function av(aT,aU){var aV=$("<div />").mousedown(b(aT)).css({cursor:aT+"-resize",position:"absolute",zIndex:aU});if(V.support){aV.bind("touchstart",V.createDragger(aT))}O.append(aV);return aV}function aF(aT){return av(aT,aM++).css({top:l(-aD+1),left:l(-aD+1),opacity:K.handleOpacity}).addClass(E("handle"))}function aL(aV){var aY=K.handleSize,aX=aY,aU=aY,aW=aD,aT=aD;switch(aV){case"n":case"s":aU=N(100);break;case"e":case"w":aX=N(100);break}return av(aV,aM++).width(aU).height(aX).css({top:l(-aW+1),left:l(-aT+1)})}function aH(aT){var aU;for(aU=0;aU<aT.length;aU++){aP[aT[aU]]=aF(aT[aU])}}function aJ(aX){var aU=Math.round((aX.h/2)-aD),aT=Math.round((aX.w/2)-aD),aV=-aD+1,a1=-aD+1,aY=aX.w-aD,aW=aX.h-aD,a0,aZ;if(aP.e){aP.e.css({top:l(aU),left:l(aY)});aP.w.css({top:l(aU)});aP.s.css({top:l(aW),left:l(aT)});aP.n.css({left:l(aT)})}if(aP.ne){aP.ne.css({left:l(aY)});aP.se.css({top:l(aW),left:l(aY)});aP.sw.css({top:l(aW)})}if(aP.b){aP.b.css({top:l(aW)});aP.r.css({left:l(aY)})}}function aC(aT,aU){L.css({top:l(-aU),left:l(-aT)});A.css({top:l(aU),left:l(aT)})}function aS(aT,aU){A.width(aT).height(aU)}function ax(){var aT=ad.getFixed();ad.setPressed([aT.x,aT.y]);ad.setCurrent([aT.x2,aT.y2]);aQ()}function aQ(){if(aE){return aB()}}function aB(){var aT=ad.getFixed();aS(aT.w,aT.h);aC(aT.x,aT.y);if(aw){aJ(aT)}if(!aE){aR()}K.onChange.call(f,ab(aT))}function aR(){A.show();if(K.bgFade){aq.fadeTo(K.fadeTime,ae)}else{aq.css("opacity",ae)}aE=true}function aN(){aO();A.hide();if(K.bgFade){aq.fadeTo(K.fadeTime,1)}else{aq.css("opacity",1)}aE=false;K.onRelease.call(f)}function au(){if(aw){aJ(ad.getFixed());O.show()}}function aI(){aw=true;if(K.allowResize){aJ(ad.getFixed());O.show();return true}}function aO(){aw=false;O.hide()}function aK(aT){if(D===aT){aO()}else{aI()}}function aG(){aK(false);ax()}if(K.drawBorders){az={top:aA("hline"),bottom:aA("hline bottom"),left:aA("vline"),right:aA("vline right")}}if(K.dragEdges){aP.t=aL("n");aP.b=aL("s");aP.r=aL("e");aP.l=aL("w")}if(K.sideHandles){aH(["n","s","e","w"])}if(K.cornerHandles){aH(["sw","nw","ne","se"])}var ay=ai().mousedown(b("move")).css({cursor:"move",position:"absolute",zIndex:360});if(V.support){ay.bind("touchstart.jcrop",V.createDragger("move"))}k.append(ay);aO();return{updateVisible:aQ,update:aB,release:aN,refresh:ax,isAwake:function(){return aE},setCursor:function(aT){ay.css("cursor",aT)},enableHandles:aI,enableOnly:function(){aw=true},showHandles:au,disableHandles:aO,animMode:aK,done:aG}}());var S=(function(){var av=function(){},ax=function(){},aw=K.trackDocument;function aE(){a.css({zIndex:450});if(aw){$(document).bind("mousemove",au).bind("mouseup",ay)}}function aC(){a.css({zIndex:290});if(aw){$(document).unbind("mousemove",au).unbind("mouseup",ay)}}function au(aF){av(I(aF));return false}function ay(aF){aF.preventDefault();aF.stopPropagation();if(q){q=false;ax(I(aF));if(Z.isAwake()){K.onSelect.call(f,ab(ad.getFixed()))}aC();av=function(){};ax=function(){}}return false}function az(aG,aF){q=true;av=aG;ax=aF;aE();return false}function aD(aF){aF.pageX=aF.originalEvent.changedTouches[0].pageX;aF.pageY=aF.originalEvent.changedTouches[0].pageY;return au(aF)}function aA(aF){aF.pageX=aF.originalEvent.changedTouches[0].pageX;aF.pageY=aF.originalEvent.changedTouches[0].pageY;return ay(aF)}function aB(aF){a.css("cursor",aF)}if(V.support){$(document).bind("touchmove",aD).bind("touchend",aA)}if(!aw){a.mousemove(au).mouseup(ay).mouseout(ay)}aq.before(a);return{activateHandlers:az,setCursor:aB}}());var ap=(function(){var ax=$('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}),az=$("<div />").css({position:"absolute",overflow:"hidden"}).append(ax);function av(){if(K.keySupport){ax.show();ax.focus()}}function ay(aA){ax.hide()}function aw(aB,aA,aC){if(K.allowMove){ad.moveOffset([aA,aC]);Z.updateVisible()}aB.preventDefault();aB.stopPropagation()}function au(aB){if(aB.ctrlKey){return true}af=aB.shiftKey?true:false;var aA=af?10:1;switch(aB.keyCode){case 37:aw(aB,-aA,0);break;case 39:aw(aB,aA,0);break;case 38:aw(aB,0,-aA);break;case 40:aw(aB,0,aA);break;case 27:Z.release();break;case 9:return true}return false}if(K.keySupport){ax.keydown(au).blur(ay);if(aj||!K.fixedSupport){ax.css({position:"absolute",left:"-20px"});az.append(ax).insertBefore(aq)}else{ax.insertBefore(aq)}}return{watchKeys:av}}());function j(au){ac.removeClass().addClass(E("holder")).addClass(au)}function s(aN,aB){var aH=parseInt(aN[0],10)/P,aw=parseInt(aN[1],10)/d,aG=parseInt(aN[2],10)/P,av=parseInt(aN[3],10)/d;if(D){return}var aF=ad.flipCoords(aH,aw,aG,av),aL=ad.getFixed(),aI=[aL.x,aL.y,aL.x2,aL.y2],ay=aI,ax=K.animationDelay,aK=aF[0]-aI[0],aA=aF[1]-aI[1],aJ=aF[2]-aI[2],az=aF[3]-aI[3],aE=0,aC=K.swingSpeed;x=ay[0];y=ay[1];aG=ay[2];av=ay[3];Z.animMode(true);var au;function aD(){window.setTimeout(aM,ax)}var aM=(function(){return function(){aE+=(100-aE)/aC;ay[0]=x+((aE/100)*aK);ay[1]=y+((aE/100)*aA);ay[2]=aG+((aE/100)*aJ);ay[3]=av+((aE/100)*az);if(aE>=99.8){aE=100}if(aE<100){an(ay);aD()}else{Z.done();if(typeof(aB)==="function"){aB.call(f)}}}}());aD()}function M(au){an([parseInt(au[0],10)/P,parseInt(au[1],10)/d,parseInt(au[2],10)/P,parseInt(au[3],10)/d])}function an(au){ad.setPressed([au[0],au[1]]);ad.setCurrent([au[2],au[3]]);Z.update()}function i(){return ab(ad.getFixed())}function al(){return ad.getFixed()}function u(au){B(au);Q()}function v(){K.disabled=true;Z.disableHandles();Z.setCursor("default");S.setCursor("default")}function Y(){K.disabled=false;Q()}function m(){Z.done();S.activateHandlers(null,null)}function ak(){ac.remove();aa.show();$(c).removeData("Jcrop")}function ar(av,aw){Z.release();v();var au=new Image();au.onload=function(){var ax=au.width;var az=au.height;var aA=K.boxWidth;var ay=K.boxHeight;aq.width(ax).height(az);aq.attr("src",av);L.attr("src",av);X(aq,aA,ay);T=aq.width();R=aq.height();L.width(T).height(R);a.width(T+(t*2)).height(R+(t*2));ac.width(T).height(R);Y();if(typeof(aw)==="function"){aw.call(f)}};au.src=av}function Q(au){if(K.allowResize){if(au){Z.enableOnly()}else{Z.enableHandles()}}else{Z.disableHandles()}S.setCursor(K.allowSelect?"crosshair":"default");Z.setCursor(K.allowMove?"move":"default");if(K.hasOwnProperty("setSelect")){M(K.setSelect);Z.done();delete (K.setSelect)}if(K.hasOwnProperty("trueSize")){P=K.trueSize[0]/T;d=K.trueSize[1]/R}if(K.hasOwnProperty("bgColor")){if(F()&&K.fadeTime){ac.animate({backgroundColor:K.bgColor},{queue:false,duration:K.fadeTime})}else{ac.css("backgroundColor",K.bgColor)}delete (K.bgColor)}if(K.hasOwnProperty("bgOpacity")){ae=K.bgOpacity;if(Z.isAwake()){if(K.fadeTime){aq.fadeTo(K.fadeTime,ae)}else{ac.css("opacity",K.opacity)}}delete (K.bgOpacity)}z=K.maxSize[0]||0;am=K.maxSize[1]||0;o=K.minSize[0]||0;W=K.minSize[1]||0;if(K.hasOwnProperty("outerImage")){aq.attr("src",K.outerImage);delete (K.outerImage)}Z.refresh()}if(V.support){a.bind("touchstart",V.newSelection)}O.hide();Q(true);var f={setImage:ar,animateTo:s,setSelect:M,setOptions:u,tellSelect:i,tellScaled:al,setClass:j,disable:v,enable:Y,cancel:m,release:Z.release,destroy:ak,focus:ap.watchKeys,getBounds:function(){return[T*P,R*d]},getWidgetSize:function(){return[T,R]},getScaleFactor:function(){return[P,d]},ui:{holder:ac,selection:A}};if($.browser.msie){ac.bind("selectstart",function(){return false})}aa.data("Jcrop",f);return f};$.fn.Jcrop=function(b,c){function a(g){var f=(typeof(b)==="object")?b:{};var e=f.useImg||g.src;var d=new Image();d.onload=function(){function i(){var k=$.Jcrop(g,f);if(typeof(c)==="function"){c.call(k)}}function j(){if(!d.width||!d.height){window.setTimeout(j,50)}else{i()}}window.setTimeout(j,50)};d.src=e}this.each(function(){if($(this).data("Jcrop")){if(b==="api"){return $(this).data("Jcrop")}else{$(this).data("Jcrop").setOptions(b)}}else{a(this)}});return this};$.Jcrop.defaults={allowSelect:true,allowMove:true,allowResize:true,trackDocument:true,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:0.6,bgFade:false,borderOpacity:0.4,handleOpacity:0.5,handleSize:9,handleOffset:5,aspectRatio:0,keySupport:true,cornerHandles:true,sideHandles:true,drawBorders:true,dragEdges:true,fixedSupport:true,touchSupport:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onRelease:function(){}}})();